Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:02<00:08,  2.88s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:04<00:04,  2.37s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:06<00:02,  2.13s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:07<00:00,  1.48s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:07<00:00,  1.81s/it]
trainable params: 3,407,872 || all params: 8,033,669,120 || trainable%: 0.04241987003816259
[INFO:minedojo.tasks] Loaded 1572 Programmatic tasks, 1558 Creative tasks, and 1 special task: "Playthrough". Totally 3131 tasks loaded.
Traceback (most recent call last):
  File "/scratch/nlp/lijiaqi/CLearning/reflexion/notebooks/Ours.py", line 62, in <module>
    global_step, rewards, achievement= policy.trainer(task, global_step, frac, writer)
  File "../ppo_llm_pomdp.py", line 195, in trainer
    action, logprob, _, value = self.agent.get_action_and_value([self.prompt + '\n'.join(trajectory)], action_list)
  File "../policy_llm.py", line 238, in get_action_and_value
    outputs = self.actor(input_ids, attention_mask=attention_mask)
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/site-packages/peft/peft_model.py", line 1129, in forward
    return self.base_model(
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/site-packages/peft/tuners/tuners_utils.py", line 161, in forward
    return self.model.forward(*args, **kwargs)
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/site-packages/accelerate/hooks.py", line 165, in new_forward
    output = old_forward(*args, **kwargs)
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/site-packages/transformers/models/llama/modeling_llama.py", line 1208, in forward
    outputs = self.model(
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/site-packages/accelerate/hooks.py", line 165, in new_forward
    output = old_forward(*args, **kwargs)
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/site-packages/transformers/models/llama/modeling_llama.py", line 1018, in forward
    layer_outputs = decoder_layer(
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/site-packages/accelerate/hooks.py", line 165, in new_forward
    output = old_forward(*args, **kwargs)
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/site-packages/transformers/models/llama/modeling_llama.py", line 756, in forward
    hidden_states = self.mlp(hidden_states)
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/site-packages/accelerate/hooks.py", line 165, in new_forward
    output = old_forward(*args, **kwargs)
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/site-packages/transformers/models/llama/modeling_llama.py", line 240, in forward
    down_proj = self.down_proj(self.act_fn(self.gate_proj(x)) * self.up_proj(x))
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1518, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1527, in _call_impl
    return forward_call(*args, **kwargs)
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/site-packages/accelerate/hooks.py", line 165, in new_forward
    output = old_forward(*args, **kwargs)
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/site-packages/bitsandbytes/nn/modules.py", line 388, in forward
    out = bnb.matmul(x, self.weight, bias=self.bias, state=self.state)
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/site-packages/bitsandbytes/autograd/_functions.py", line 559, in matmul
    return MatMul8bitLt.apply(A, B, out, bias, state)
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/site-packages/torch/autograd/function.py", line 539, in apply
    return super().apply(*args, **kwargs)  # type: ignore[misc]
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/site-packages/bitsandbytes/autograd/_functions.py", line 323, in forward
    CA, CAt, SCA, SCAt, coo_tensorA = F.double_quant(A.to(torch.float16), threshold=state.threshold)
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/site-packages/bitsandbytes/functional.py", line 2005, in double_quant
    nnz = nnz_row_ptr[-1].item()
KeyboardInterrupt
Error in atexit._run_exitfuncs:
Traceback (most recent call last):
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/site-packages/posthog/client.py", line 400, in join
    consumer.join()
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/threading.py", line 1029, in join
    self._wait_for_tstate_lock()
  File "/scratch/lijiaqi/.conda/envs/craft/lib/python3.9/threading.py", line 1045, in _wait_for_tstate_lock
    elif lock.acquire(block, timeout):
KeyboardInterrupt
